# Pull Request: Issue #34 - 習慣化サポート通知のスケジューリング実装

## 概要
Issue #34 の実装: 習慣化サポート通知のスケジューリング機能を追加しました。ユーザーが設定した時間帯（固定21:00）に合わせてリマインド通知をスケジュールし、暴飲暴食抑制をサポートする機能を実装しました。

## 変更内容

### 修正
- `EatLock/EatLock/NotificationManager.swift`: 習慣化サポート通知機能を大幅拡張
  - `scheduleDailyReminder(time:)` メソッドを追加（デフォルト21:00での毎日通知）
  - `scheduleStreakReminderIfNeeded()` メソッドを追加（連続記録が途切れそうなタイミングでの通知）
  - `setDailyReminderEnabled(_:)` メソッドを追加（通知の有効/無効切り替え）
  - `cancelDailyReminder()` および `cancelStreakReminder()` メソッドを追加
  - モチベーションメッセージ配列を追加（基本メッセージ10種類、連続記録用5種類）
  - UserDefaultsによる設定永続化機能を追加
  - 通知カテゴリーの拡張（DAILY_REMINDER、STREAK_REMINDER）

- `EatLock/EatLock/Views/Components/NotificationTestView.swift`: 新機能のテスト機能を追加
  - デイリーリマインダー有効/無効切り替えToggle
  - デイリーリマインダーのスケジュール/キャンセルボタン
  - 連続記録リマインダーのテストボタン
  - カスタム時間（22時）でのリマインダーテストボタン

## 技術詳細

### アーキテクチャの変更点
- NotificationManagerクラスに習慣化サポート機能を統合
- UNUserNotificationCenterを活用した定期通知システムの実装
- 設定の永続化にUserDefaultsを使用

### 採用した技術やライブラリ
- **UNUserNotificationCenter**: ローカル通知の管理
- **UNCalendarNotificationTrigger**: 毎日定時での通知繰り返し
- **UNTimeIntervalNotificationTrigger**: 連続記録リマインダーの遅延実行
- **UserDefaults**: デイリーリマインダー設定の永続化

### その他、特筆すべき技術的判断
- モチベーションメッセージのランダム選択による通知内容の多様化
- 通知権限チェックによる適切なエラーハンドリング
- 初回起動時のデフォルト設定（デイリーリマインダー有効）
- 通知カテゴリーによる通知種別の管理

## 動作確認

- [x] scheduleDailyReminderメソッドが正常に動作する
- [x] 通知が指定時刻（21:00）に届く
- [x] デイリーリマインダーの有効/無効切り替えが機能する
- [x] 連続記録リマインダーが適切にスケジュールされる
- [x] 通知権限が拒否されている場合の適切な処理
- [x] モチベーションメッセージがランダムに表示される
- [x] NotificationTestViewでの各機能テストが正常動作
- [x] 既存の通知機能に影響がない
- [x] アプリ起動時の自動初期化が動作する
- [x] 設定の永続化が正常に機能する
- [x] ビルドエラーがない

## 関連Issue
Closes #34

## スクリーンショット（UI変更がある場合）

NotificationTestViewに以下のUI要素を追加：

| 機能 | 説明 |
|------|------|
| デイリーリマインダーToggle | 通知の有効/無効を切り替え |
| デイリーリマインダーをスケジュールボタン | 21時の毎日通知を設定 |
| 連続記録リマインダーをテストボタン | 連続記録サポート通知をテスト |
| デイリーリマインダーをキャンセルボタン | 設定済み通知をキャンセル |
| カスタム時間でリマインダーボタン | 22時でのテスト通知を設定 |

## 特記事項

### 実装仕様について
- 設定変更UIは後続タスクで実装予定のため、現在は固定時間（21:00）で対応
- デイリーリマインダーは初回起動時にデフォルトで有効に設定
- 連続記録チェック機能は簡易実装（将来的にActionLogRepositoryとの連携で改善予定）

### 技術的な注意点
- 通知権限が拒否されている場合は、全ての通知機能が無効化される
- iOS 17以降のUNUserNotificationCenter APIを使用
- 通知は端末のローカル通知として実装（プライバシー保護）

### 将来の拡張性
- 時刻設定UIの追加時に、scheduleDailyReminder(time:)の引数を活用可能
- 連続記録の実際のデータ分析機能との連携が容易
- 通知メッセージの種類追加や多言語対応への拡張が可能

### Performance Impact
- 通知スケジューリングは軽量で、アプリのパフォーマンスに影響なし
- UserDefaultsによる設定保存は最小限のオーバーヘッド
- メモリ使用量への影響は微小

### セキュリティ考慮事項
- 通知内容に個人情報は含まれていない
- 通知権限は適切にユーザーの同意を得て使用
- 端末内での処理のため、外部サーバーへのデータ送信なし